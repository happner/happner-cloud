'use strict';

var happner_user_management = angular.module('happnerUserManagement', [  
  'happnerAngular',
  'ui.bootstrap',                                            
  'ngAnimate',
  'angularMoment',
  'cgNotify'
]);

happner_user_management.controller('happnerUserManagementCtl', ['$rootScope', '$scope', 'happnerAngularClient', 'notify', function($rootScope, $scope, happnerAngularClient, notify) {

    $scope.authenticated = false;
    $scope.dburl = "127.0.0.1";

    $scope.dbport = window.location.port.toString();
    $scope.dbsecret = "mesh";
    $scope.view = 'network';

    $scope.changeView = function(view, action){
        $rootScope.view = view;
        $rootScope.action = action;
    }

    var funcNotify = function(message, type, duration, container){

      notify.closeAll();

      var params = {position:'right'};

      params.message = message;

      if (type) params.classes = 'alert-' + type;

      if (container) params.container = container;

      if (duration) params.duration = duration;

      notify(params);
    }

    $rootScope.notify = funcNotify;

    $scope.notify = funcNotify;

    $scope.authenticate = function(){

    	happnerAngularClient.authenticate($scope.dburl, $scope.dbport, null, $scope.dbsecret, function(e, client){

          console.log(e, client);

          $scope.authenticated = true;

          happnerAngularClient.networkManagerEvent.on('NETWORK-EVT', 
          function(){

          }, 
          function(e){
            
          });

          $scope.$apply();

        });
    }   
    
}]);

