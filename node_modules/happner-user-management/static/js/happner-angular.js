// declare a module
var happnerAngular = angular.module('happnerAngular', []);

happnerAngular.factory('happnerAngularClient', function() {
 	var happnerService = function(){};

 	if (!MeshClient)
 		throw new Error('happner mesh client has not been referenced, please check your html');

 	happnerService.prototype.authenticate = function(dburl, dbport, dbuser, dbsecret, callback){

 		var _this = this;

 		console.log('authenticating', arguments);

 		new MeshClient(dburl, dbport, dbsecret, function(e, client){

 			if (e) return callback(e);

 			console.log('authenticated', arguments);

 			_this.__clientInstance = client;

 			client

	        callback(null, client);
      	});
 	};

 	happnerService.prototype.getClient = function(){
 		if (!this.__clientInstance) throw new Error('you have not authenticated yet');

 		return this.__clientInstance;
 	}

 	happnerService.prototype.onSecurityDirectoryChanged = function(params, handler){

 	}

 	happnerService.prototype.offSecurityDirectoryChanged = function(key, handler){

 	}

 	return new happnerService();

});

