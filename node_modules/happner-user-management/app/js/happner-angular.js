// declare a module
var happnerAngular = angular.module('happnerAngular', []);

happnerAngular.factory('happnerAngularClient', function() {
 	var happnerService = function(){};

 	if (!MeshClient)
 		throw new Error('happner mesh client has not been referenced, please check your html');

 	happnerService.prototype.authenticate = function(dburl, dbport, dbuser, dbsecret, callback){

 		var _this = this;

 		new MeshClient(dburl, dbport, dbsecret, function(e, client){

 			if (e) return callback(e);

 			_this.__clientInstance = client;

 			_this.networkManager = _this.__clientInstance.exchange.happnerSecurityNetwork;
 			_this.groupManager = _this.__clientInstance.exchange.happnerSecurityGroup;
 			_this.userManager = _this.__clientInstance.exchange.happnerSecurityUser;

 			_this.networkManagerEvent = _this.__clientInstance.event.happnerSecurityNetwork;
 			_this.groupManagerEvent = _this.__clientInstance.event.happnerSecurityGroup;
 			_this.userManagerEvent = _this.__clientInstance.event.happnerSecurityUser;

 			console.log(_this.__clientInstance);

	        callback(null, client);
      	});
 	};

 	happnerService.prototype.getClient = function(){
 		if (!this.__clientInstance) throw new Error('you have not authenticated yet');

 		return this.__clientInstance;
 	}


 	return new happnerService();

});

